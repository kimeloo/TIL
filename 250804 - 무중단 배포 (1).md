
```table-of-contents
```

# AWS Blue/Green 무중단 배포 실습 가이드
https://devlog-wjdrbs96.tistory.com/301?category=885022
## 개요

Blue/Green 배포는 두 개의 동일한 운영 환경을 사용하여 무중단 배포를 구현하는 방식입니다.

- **Blue**: 현재 운영 중인 환경
- **Green**: 새로운 버전이 배포될 환경

## 사전 준비사항

- Blue/Green 배포 방식에 대한 이해 ([참조](https://devlog-wjdrbs96.tistory.com/300))
- AWS 계정 및 필요한 권한
- 배포할 애플리케이션의 AMI 이미지

## 1. Blue 그룹 생성 (Auto Scaling Group)

### 시작 템플릿 생성

1. EC2 > 시작 템플릿 메뉴로 이동
2. 새 시작 템플릿 생성
3. 다음 항목 설정:
    - **AMI**: 현재 운영 중인 애플리케이션 이미지
    - **인스턴스 유형**: 적절한 인스턴스 타입 선택 (예: t2.micro)
    - **보안 그룹**: 필요한 포트(22, 80 등) 허용
    - **키 페어**: 필요시 설정

### Auto Scaling 그룹 생성

1. EC2 > Auto Scaling 그룹 메뉴로 이동
2. 새 Auto Scaling 그룹 생성
3. 설정 항목:
    - **시작 템플릿**: 위에서 생성한 템플릿 선택
    - **가용 영역**: 최소 2개 이상 선택 (고가용성을 위함)
    - **로드 밸런서**: 기존 ALB/NLB 연결
    - **용량 설정**:
        - 원하는 용량: 평상시 유지할 인스턴스 수
        - 최소 용량: 최소 유지할 인스턴스 수
        - 최대 용량: 최대 허용할 인스턴스 수

### Auto Scaling 정책 설정

- **확장 정책**: CPU 사용률 50% 초과 시 확장
- **축소 정책**: CPU 사용률이 낮을 때 축소
- **휴지 기간**: 적절한 쿨다운 시간 설정

## 2. 새로운 버전 준비 (Green 그룹)

### 새 버전의 AMI 생성

1. 새로운 코드가 적용된 EC2 인스턴스에서 AMI 생성
2. AMI 생성 과정:
    - 인스턴스 선택 > 작업 > 이미지 및 템플릿 > 이미지 생성
    - 이미지 이름 지정 (버전 정보 포함 권장)
    - 생성 완료까지 대기 (상태: available)

### 새로운 시작 템플릿 생성

1. 새 시작 템플릿 생성
2. 설정 항목:
    - **AMI**: 새로 생성한 AMI 선택
    - **인스턴스 유형**: 기존과 동일하게 설정
    - **보안 그룹**: 기존과 동일한 보안 그룹 사용
    - **기타 설정**: Blue 그룹과 동일하게 설정

## 3. Green 그룹 생성 및 배포

### Green Auto Scaling 그룹 생성

1. 새로운 Auto Scaling 그룹 생성
2. 설정 항목:
    - **시작 템플릿**: 새로 생성한 템플릿 선택
    - **네트워크 설정**: Blue 그룹과 동일
    - **로드 밸런서**: 동일한 로드 밸런서에 연결
    - **용량 설정**: Blue 그룹과 동일

### 배포 확인

1. 로드 밸런서의 대상 그룹에서 인스턴스 상태 확인
2. 새 인스턴스가 `healthy` 상태인지 확인
3. 로드 밸런서 DNS로 접속하여 동작 확인

## 4. 트래픽 전환 및 Blue 그룹 제거

### 트래픽 확인

- 로드 밸런서를 통해 Blue/Green 그룹이 번갈아 트래픽을 받는지 확인
- 새 버전(Green)이 정상 동작하는지 검증

### Blue 그룹 제거

1. 로드 밸런서 대상 그룹에서 Blue 그룹 인스턴스 등록 취소
2. Green 그룹만 트래픽을 받는지 확인
3. 문제없음을 확인 후 Blue Auto Scaling 그룹 삭제

## 5. 배포 검증 및 정리

### 배포 검증 체크리스트

- [ ]  애플리케이션 정상 동작 확인
- [ ]  로드 밸런서를 통한 접속 정상 확인
- [ ]  모니터링 지표 확인 (CPU, 메모리, 네트워크 등)
- [ ]  로그 확인

### 리소스 정리

- 사용하지 않는 AMI 정리
- 불필요한 시작 템플릿 제거
- Blue 그룹 관련 리소스 삭제

## 장점과 한계

### 장점

- **무중단 배포**: 서비스 중단 없이 배포 가능
- **즉시 롤백**: 문제 발생 시 빠른 롤백 가능
- **안전한 배포**: 새 버전 검증 후 트래픽 전환

### 한계

- **리소스 비용**: 두 배의 인프라 리소스 필요
- **수동 작업**: AMI 생성 및 배포 과정의 수작업 필요
- **복잡성**: 초기 설정 및 관리의 복잡성

## 다음 단계

- **자동화 구축**: AWS CodeDeploy를 활용한 자동화된 Blue/Green 배포
- **모니터링 강화**: CloudWatch를 통한 세밀한 모니터링 설정
- **CI/CD 통합**: Jenkins, GitLab CI 등과의 연동

## 참고사항

- 데이터베이스 스키마 변경이 있는 경우 별도의 마이그레이션 전략 필요
- 세션 관리가 필요한 애플리케이션의 경우 세션 스토어 고려
- 비용 최적화를 위한 스케줄링 정책 검토